<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FileZila - The Ultimate File Converter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="//static.filestackapi.com/filestack-js/3.x.x/filestack.min.js"></script>
    <style>
        .progress-bar-container { width: 100%; background-color: #e5e7eb; border-radius: 9999px; overflow: hidden; }
        .progress-bar { height: 1rem; background-color: #3b82f6; width: 0%; transition: width 0.3s ease-in-out; border-radius: 9999px; }
        .card-touch { -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 antialiased">

    <div id="converter-page" class="min-h-screen">
        <header class="bg-white dark:bg-gray-800 shadow-md">
            <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 flex items-center justify-center h-10 w-10 rounded-full bg-blue-100 dark:bg-gray-700">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-600 dark:text-blue-300"><path d="M8 3L4 7l4 4"/><path d="M4 7h16"/><path d="M16 21l4-4-4-4"/><path d="M20 17H4"/></svg>
                        </div>
                        <span class="ml-3 text-xl font-bold text-gray-900 dark:text-white">FileZila</span>
                    </div>
                </div>
            </div>
        </header>

        <main class="py-10">
            <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                <section id="uploader-section" class="text-center">
                    <h1 class="text-4xl font-extrabold text-gray-900 dark:text-white sm:text-5xl">FileZila Tools</h1>
                    <p class="mt-4 max-w-2xl mx-auto text-lg text-gray-500 dark:text-gray-400">Select a tool below to get started.</p>

                    <div class="mt-10 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6">
                        <div id="word-to-pdf" class="card-touch bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center cursor-pointer hover:shadow-xl transition-shadow">
                             <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 dark:bg-blue-900"><span class="font-bold text-blue-600 dark:text-blue-300 text-xl">W</span></div>
                            <h3 class="mt-4 text-lg font-medium text-gray-900 dark:text-white">Word to PDF</h3>
                            <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Make DOC and DOCX files easy to read and share.</p>
                        </div>
                        <div id="ppt-to-pdf" class="card-touch bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center cursor-pointer hover:shadow-xl transition-shadow">
                            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-orange-100 dark:bg-orange-900"><span class="font-bold text-orange-600 dark:text-orange-300 text-xl">P</span></div>
                            <h3 class="mt-4 text-lg font-medium text-gray-900 dark:text-white">PowerPoint to PDF</h3>
                            <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Convert PPTX and PPT slideshows into a PDF.</p>
                        </div>
                        <div id="excel-to-pdf" class="card-touch bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center cursor-pointer hover:shadow-xl transition-shadow">
                            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 dark:bg-green-900"><span class="font-bold text-green-600 dark:text-green-300 text-xl">X</span></div>
                            <h3 class="mt-4 text-lg font-medium text-gray-900 dark:text-white">Excel to PDF</h3>
                            <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Turn XLSX and XLS spreadsheets into a PDF document.</p>
                        </div>
                        <div id="image-to-pdf" class="card-touch bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center cursor-pointer hover:shadow-xl transition-shadow">
                            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-purple-100 dark:bg-purple-900"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-purple-600 dark:text-purple-300"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M20.4 14.5L16 10 4 20"/></svg></div>
                            <h3 class="mt-4 text-lg font-medium text-gray-900 dark:text-white">Image to PDF</h3>
                            <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Edit, crop, and convert images into a single PDF file.</p>
                        </div>
                        <div id="image-to-text" class="card-touch bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center cursor-pointer hover:shadow-xl transition-shadow">
                             <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-gray-100 dark:bg-gray-700"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600 dark:text-gray-300"><polygon points="16 3 21 8 8 21 3 21 3 16 16 3"></polygon></svg></div>
                            <h3 class="mt-4 text-lg font-medium text-gray-900 dark:text-white">Image to Text (OCR)</h3>
                            <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Extract text from any image or scanned document.</p>
                        </div>
                    </div>
                    <p id="error-message" class="mt-6 text-red-500"></p>
                </section>

                <section id="progress-section" class="hidden text-center mt-10">
                    <h2 id="progress-title" class="text-3xl font-bold text-gray-900 dark:text-white">Processing...</h2>
                    <p id="progress-subtitle" class="mt-2 text-gray-500 dark:text-gray-400">Your file is being processed.</p>
                    <div class="mt-8 max-w-md mx-auto">
                        <div class="progress-bar-container"><div id="progress-bar" class="progress-bar"></div></div>
                        <p id="progress-text" class="mt-2 text-sm font-medium text-gray-900 dark:text-gray-200">0%</p>
                    </div>
                </section>

                <section id="success-section" class="hidden text-center mt-10">
                     <h2 class="text-3xl font-bold text-green-500">Process Complete!</h2>
                     <p class="mt-2 text-gray-500 dark:text-gray-400">Your file is ready for download.</p>
                     <div class="mt-8 flex flex-col sm:flex-row sm:justify-center items-center gap-4">
                         <a id="download-link" href="#" download="converted-file" class="w-full sm:w-auto inline-flex items-center justify-center px-5 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">Download File</a>
                         <button id="convert-another-button" class="w-full sm:w-auto inline-flex items-center justify-center px-5 py-3 border border-gray-300 dark:border-gray-600 text-base font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700">Convert Another File</button>
                     </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {

            const client = filestack.init('ACL47Xn7TUCQVIpNWjTqgz');
            const uploaderSection = document.getElementById('uploader-section');
            const progressSection = document.getElementById('progress-section');
            const successSection = document.getElementById('success-section');
            const errorMessage = document.getElementById('error-message');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const progressSubtitle = document.getElementById('progress-subtitle');
            const downloadLink = document.getElementById('download-link');
            const convertAnotherButton = document.getElementById('convert-another-button');

            document.getElementById('word-to-pdf').addEventListener('click', () => initiateConversion({ targetFormat: 'pdf', acceptedFiles: ['.doc', '.docx'] }));
            document.getElementById('ppt-to-pdf').addEventListener('click', () => initiateConversion({ targetFormat: 'pdf', acceptedFiles: ['.ppt', '.pptx'] }));
            document.getElementById('excel-to-pdf').addEventListener('click', () => initiateConversion({ targetFormat: 'pdf', acceptedFiles: ['.xls', '.xlsx'] }));
            document.getElementById('image-to-pdf').addEventListener('click', () => initiateConversion({ targetFormat: 'pdf', acceptedFiles: ['image/*'], useEditor: true }));
            document.getElementById('image-to-text').addEventListener('click', () => initiateConversion({ targetFormat: 'txt', acceptedFiles: ['image/*'] }));
            convertAnotherButton.addEventListener('click', resetUI);

            // ✅ --- FIXED CORE LOGIC ---
            function initiateConversion(config) {
                // Start with the base options
                const pickerOptions = {
                    fromSources: ['local_file_system', 'url', 'googledrive', 'dropbox'],
                    accept: config.acceptedFiles,
                    maxFiles: 1,
                    onUploadDone: (result) => {
                        const file = result.filesUploaded[0];
                        if (file.mimetype && file.mimetype.startsWith('image/')) {
                            checkForUnsafeContent(file, config.targetFormat);
                        } else {
                            performConversion(file, config.targetFormat);
                        }
                    },
                };
                
                // Safely add the editor property ONLY if it's needed
                if (config.useEditor) {
                    pickerOptions.editor = { crop: true, rotate: true, circle: false };
                }

                client.picker(pickerOptions).open();
            }
            
            async function checkForUnsafeContent(file, targetFormat) {
                updateUIForProcessing('Analyzing for safety...');
                try {
                    const moderationResult = await client.transform(file.handle, { nsfw: true });
                    if (moderationResult && moderationResult.nsfw === true) {
                        showError('This image could not be processed due to our content policy.');
                        resetUI();
                    } else {
                        performConversion(file, targetFormat);
                    }
                } catch (error) {
                    console.error('Moderation check failed:', error);
                    showError('Could not analyze the file. Please try again.');
                    resetUI();
                }
            }

            async function performConversion(file, targetFormat) {
                const originalFileName = file.filename;
                const newFileName = `${originalFileName.split('.').slice(0, -1).join('.')}.${targetFormat}`;
                updateUIForProcessing('Converting your file...');
                
                try {
                    const task = targetFormat === 'txt' ? { ocr: {} } : { output: { format: targetFormat } };
                    const transformedUrl = await client.transform(file.handle, task);

                    updateProgressUI(100, 'Complete!');
                    showSuccess(transformedUrl, newFileName);

                } catch (error) {
                    console.error('Conversion failed:', error);
                    showError('Sorry, the conversion failed. Please try another file.');
                    resetUI();
                }
            }

            function updateUIForProcessing(subtitle) {
                uploaderSection.classList.add('hidden');
                progressSection.classList.remove('hidden');
                progressSubtitle.textContent = subtitle;
                progressBar.style.width = '50%';
                progressText.textContent = '50%';
            }

            function updateProgressUI(percentage, text) {
                progressBar.style.width = `${percentage}%`;
                progressText.textContent = `${percentage}%`;
                progressSubtitle.textContent = text;
            }

            function showSuccess(url, fileName) {
                downloadLink.href = url;
                downloadLink.download = fileName;
                progressSection.classList.add('hidden');
                successSection.classList.remove('hidden');
            }

            function showError(message) {
                errorMessage.textContent = message;
            }

            function resetUI() {
                successSection.classList.add('hidden');
                progressSection.classList.add('hidden');
                uploaderSection.classList.remove('hidden');
                errorMessage.textContent = '';
                updateProgressUI(0, '');
            }
        });
    </script>
</body>
</html>
